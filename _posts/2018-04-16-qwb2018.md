---
title:  AWD QWB CTF 2018 
subtitle: AWD
time: 2018.04.16 10:00:00
layout: post
catalog: true
tags:
- CTF
- Web
excerpt: è®°è¢«RiatreåŠæ‰“çš„ä¸€åœºçº¿ä¸‹èµ›ï¼Œå®åœ¨å¤ªå¼ºï¼Œè¿˜éœ€è¦ç»§ç»­åŠªåŠ›ğŸ’ª

---

# å¼ºç½‘æ¯çº¿ä¸‹èµ›å°è®°

è¿™æ¬¡æ¯”èµ›æ•´ä½“æ¥è¯´è´¨é‡è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œå¯æƒœçº¿ä¸‹èµ›å°±ä¸€é“Webé¢˜ï¼Œå¤–åŠ iæ˜¥ç§‹å¹³å°ç½‘ç»œæ‹“æ‰‘çš„é™åˆ¶ï¼Œå¯¼è‡´å¾ˆå¤šå¥½ç©çš„æ“ä½œéƒ½æ‰“ä¸å‡ºæ¥ã€‚ä¸è¿‡ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºåªæœ‰ä¸€é“Webé¢˜ï¼Œæ‰èƒ½è§è¯†åˆ°å„ä½é€‰æ‰‹ä»¬æ–°é¢–çš„æ€è·¯ï¼šå¦‚ä½•ç”¨100ç§æ–¹å¼æŠŠåˆ«äººçš„Gameboxæ‰“downğŸ˜‚ã€‚æ•´ä¸ªæ¯”èµ›ï¼ŒåŸºæœ¬éƒ½æ˜¯åœ¨ç»´æŠ¤WebæœåŠ¡ï¼Œä¿è¯Webä¸downã€‚

æ•´ä¸ªWebé¢˜ï¼Œè‡³ä»Šå·²çŸ¥çš„å¤§æ¦‚æœ‰ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»ã€å‰å°ä¸€ä¸ªä»»æ„æ–‡ä»¶å†™ã€åå°ä¸€ä¸ªä»»æ„æ–‡ä»¶å†™ã€ä»»æ„æ–‡ä»¶è¯»ã€Nä¸ªSQLæ³¨å…¥å’Œä¸€ä¸ªè¶Šæƒæ“ä½œã€‚ä»¥å‰ä¸€ç›´ä»¥ä¸ºçº¿ä¸‹èµ›çš„æœ€ç»ˆç›®çš„å°±åº”è¯¥æ˜¯å¯»æ‰¾æ¼æ´ï¼Œè·å¾—RCEï¼Œç§åé—¨ï¼Œç»´æŒæƒé™ã€‚ä¹Ÿå› æ­¤ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºåœ¨çº¿ä¸‹èµ›ï¼ŒXSSã€SQLæ³¨å…¥ã€SSRFã€è¶Šæƒç­‰ç­‰ä¸€èˆ¬éƒ½ä¸éœ€è¦è€ƒè™‘çš„ã€‚ç„¶è€Œï¼Œç»è¿‡è¿™æ¬¡æ¯”èµ›ï¼Œæˆ‘æ‰çœŸæ­£æ„è¯†åˆ°åŸæ¥ä¸€ä¸ªSQLæ³¨å…¥ä¹Ÿå¯ä»¥åœ¨çº¿ä¸‹èµ›å±•ç°å‡ºè¿™ä¹ˆå¤§çš„å¨åŠ›ã€‚

ä»¥ä¸‹æ€»ç»“ä¸€ä¸‹æ¯”èµ›è¿‡ç¨‹ä¸­å­¦ä¹ åˆ°çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚

### MysqlåŸºç¡€çŸ¥è¯†

åœ¨æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œç”±äºåˆšé‡ç½®mampä¸€äº›é…ç½®éƒ½æ²¡äº†ï¼Œå¯¼è‡´åœ¨æœ¬åœ°æ€ä¹ˆä¹Ÿæ­å»ºä¸èµ·æ¥ï¼Œè®°å½•ä¸€ä¸‹ã€‚

localhostå’Œ127.0.0.1çš„å¼‚åŒï¼ˆä»…é’ˆå¯¹mysqlï¼Œå’Œlinuxçš„localhostã€127.0.0.1ä¸ä¸€æ ·)ï¼š

>  localhot(local) æ˜¯ä¸ç»ç½‘å¡ä¼ è¾“ï¼è¿™ç‚¹å¾ˆé‡è¦ï¼Œå®ƒä¸å—ç½‘ç»œé˜²ç«å¢™å’Œç½‘å¡ç›¸å…³çš„çš„é™åˆ¶ã€‚
> 127.0.0.1 æ˜¯é€šè¿‡ç½‘å¡ä¼ è¾“ï¼Œä¾èµ–ç½‘å¡ï¼Œå¹¶å—åˆ°ç½‘ç»œé˜²ç«å¢™å’Œç½‘å¡ç›¸å…³çš„é™åˆ¶ã€‚
> ä¸€èˆ¬è®¾ç½®ç¨‹åºæ—¶æœ¬åœ°æœåŠ¡ç”¨ localhost æ˜¯æœ€å¥½çš„ï¼Œlocalhost ä¸ä¼šè§£ææˆ IPï¼Œä¹Ÿä¸ä¼šå ç”¨ç½‘å¡ã€ç½‘ç»œèµ„æºã€‚
> æœ‰æ—¶å€™ç”¨ localhost å¯ä»¥ï¼Œä½†ç”¨ 127.0.0.1 å°±ä¸å¯ä»¥çš„æƒ…å†µå°±æ˜¯åœ¨äºæ­¤ã€‚çŒœæƒ³ localhost è®¿é—®æ—¶ï¼Œç³»ç»Ÿå¸¦çš„æœ¬æœºå½“å‰ç”¨æˆ·çš„æƒé™å»è®¿é—®ï¼Œ
> è€Œç”¨ IP çš„æ—¶å€™ï¼Œç­‰äºæœ¬æœºæ˜¯é€šè¿‡ç½‘ç»œå†å»è®¿é—®æœ¬æœºï¼Œå¯èƒ½æ¶‰åŠåˆ°ç½‘ç»œç”¨æˆ·çš„æƒé™ã€‚

æ‰€ä»¥ï¼š

1. mysql -h 127.0.0.1 çš„æ—¶å€™ï¼Œä½¿ç”¨ TCP/IP è¿æ¥
2. mysql -h localhost çš„æ—¶å€™ï¼Œæ˜¯ä¸ä½¿ç”¨ TCP/IP è¿æ¥çš„ï¼Œè€Œä½¿ç”¨ Unix socketï¼›æ­¤æ—¶ï¼Œmysql server åˆ™è®¤ä¸ºè¯¥ client æ˜¯æ¥è‡ª â€œlocalhostâ€

å› æ­¤ï¼Œå¦‚æœè¦ç”¨127.0.0.1æ¥è¿›è¡Œè¿æ¥æ—¶ï¼Œä¸€å®šè¦å¼€å¯MAMPçš„`Allow network access to MySQL`åŠŸèƒ½ï¼Œä¸ç„¶ä¼šå‡ºç°connection refuseçš„ç°è±¡ã€‚

æ­¤å¤–ï¼Œå¦‚æœè¦ä¿®æ”¹parameters.ymlæ–‡ä»¶ä¸­çš„é…ç½®ï¼Œä½¿è¿æ¥èµ°localhost socketé€šé“ï¼Œé‚£ä¹ˆéœ€è¦é¦–å…ˆåˆ é™¤app/cacheæ–‡ä»¶ï¼Œæ‰èƒ½çœŸæ­£ä½¿èƒ½æˆ‘ä»¬çš„ä¿®æ”¹å†…å®¹ã€‚

è¿™ä¸ªWebé¢˜æœ‰åŸºæœ¬æ²¡æœ‰é™åˆ¶çš„SQLæ³¨å…¥ï¼Œå¯¼è‡´æ”»å‡»æ‰‹å¯ä»¥ä»»æ„ä¿®æ”¹æ•°æ®åº“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·å¯†ç ã€ç”¨æˆ·ã€å„ç§æ•°æ®åº“æ“ä½œã€‚

è®°å½•ä¸€äº›æ”»å‡»æ–¹å¼å’Œé˜²å¾¡æªæ–½ï¼š

```sql
drop database edusoho;#åˆ åº“
update mysql.user set authentication_string=PASSWORD('hi23333');# ä¿®æ”¹æ‰€æœ‰ç”¨æˆ·å¯†ç 
flush privileges;
UPDATE mysql.user SET User='aaaaaaaaaaaa' WHERE user='root'; 
flush privileges;
#é™æƒ
grant all on *.* to moxiaoxi@localhost identified by 'moxiaoxi';#ä¸€å¥è¯å®Œæˆï¼Œå…·ä½“æƒé™ä¿®æ”¹all
grant select, update on dbname.* to username@'%' identified by 'password'
CREATE USER 'test'@'localhost' IDENTIFIED BY '123456'; #create userä½¿ç”¨
GRANT ALL ON databasename.* TO 'dog'@'localhost'ï¼›
flush privileges;
delete from mysql.user ;#åˆ é™¤æ‰€æœ‰ç”¨æˆ·
flush privileges;
```

å¯ä»¥ç”¨ä¸€ä¸ªbashæ— é™æ‰§è¡Œæ¥ä¿æŠ¤æ•°æ®

```sql
#!/bin/sh
sql="
delete from user where id=1;
delete from user where id=2;
delete from user where id=3;
INSERT INTO user VALUES (1,'admin@admin.admin','','ceVlajyMRMai5fZgMsVWONHqT1oo5yO/ZZUvPMMTs1A=','34zq6f815g84ww44ww0wsckk44kok04','','',NULL,'','admin','admin','','default',0,0,'public://default/2017/09-27/21374040438b731443.png','public://default/2017/09-27/213740403024308615.png','public://default/2017/09-27/213740401c25733180.png',1,1,'|ROLE_USER|ROLE_TEACHER|ROLE_SUPER_ADMIN|',0,0,0,0,0,0,0,1506566358,'172.17.0.1','qc8phortur7geu00bpitu024o1',0,'unapprove',0,0,'',1506519316,1506566358,NULL,1,'1.',''),(2,'user_seoadickk@edusoho.net','','+9tE6Xx7na+CK/NpolrRQEISKt7wYGpGQNcCimz9aME=','pr35kto2ilcgw4k008kgs4s8gwo0gc8','','',NULL,'','userm0zktb(ç³»ç»Ÿç”¨æˆ·)','','','system',0,0,'','','',1,1,'|ROLE_USER|ROLE_SUPER_ADMIN|',0,0,0,0,0,0,0,1506564289,'172.17.0.1','6hpidoqjs0cqnhfvmbdc91avq2',0,'unapprove',0,0,'',1506519316,1506564289,NULL,1,'1.',''),(3,'teacher@teacher.teacher','','ns+vr5Mxwmdtm37RzAE9OO5H6pDYzvMLw27daoQfDo0=','sr6c1dqxx2s80000wogks40skwc888g','','',NULL,'','teacher','','','import',0,0,'','','',0,1,'|ROLE_TEACHER|ROLE_USER|',0,0,0,0,0,0,0,1506568255,'172.17.0.1','43vmu844mthr4jeavgllld6ol5',0,'unapprove',1,0,'172.17.0.1',1506519434,1506568255,NULL,1,'1.','');
delete from course_set_v8 where id=1;
INSERT INTO course_set_v8 VALUES (1,'normal','é£çŒªæ™®é€šè¯¾ç¨‹','','',0,NULL,'','',0,'','published',1,1506519674,1506567784,'none',0,0,0,9,0,0,0,1,'1.',0,10.00,0,100,0,0,0,0.00,0.00,'|1|',1);
delete from classroom where id=1;
INSERT INTO classroom VALUES (1,'é£çŒªæé«˜ç­','published',NULL,0,NULL,0.00,0,'','','',3,'[\"1\"]',NULL,0,0,4,0,0,0,0,0,0,0,0.00,1506564550,1506567866,NULL,0,0,100,0,100,1,1,'0',1,'1.','forever',0,1);
"
MYSQL="/Applications/MAMP/Library/bin/mysql -uroot -proot -Dedusoho"
result="$($MYSQL -e "$sql")"
echo $result

```

æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡è§¦å‘å™¨æ¥è¿›è¡Œä¿æŠ¤ï¼Œä¸è¿‡ç”±äºå¾ˆéš¾çŸ¥é“checkæ£€æŸ¥äº†å“ªäº›åœ°æ–¹ï¼Œå¾ˆå®¹æ˜“ä¿®æŒ‚ã€‚



## Tips

è¿™ä¸ªæ¯”èµ›å¯ä»¥ä½¿ç”¨.htaccessï¼Œæ‰€ä»¥å¯¼è‡´åŸºæœ¬ä¸Šå¾ˆéš¾å†™shellã€‚æ‰€ä»¥åæœŸå¤§å®¶éƒ½åœ¨å°è¯•æ‰“downåˆ«äººçš„æœåŠ¡ã€‚è€Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œæˆ‘ä»¬å°±æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯æ¥æ‰“åˆ«äººã€‚

å‡è®¾ä½ æ‰¾åˆ°äº†ä»»æ„ä¸€ä¸ªrceï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªRCEå¿«é€Ÿå†™ä¸€ä¸ªå†…å­˜é©¬ï¼ˆæˆ–è€…ç«äº‰å†…å­˜é©¬ç­‰ç­‰ï¼‰ã€‚ç„¶åè¿…é€Ÿç”¨ä¸€å¥è¯æ‰§è¡ŒsystemæŒ‡ä»¤ï¼Œä¿®æ”¹å¯¹é¢æ•°æ®åº“userå¯†ç ï¼Œä½¿å¯¹æ–¹downæœºã€‚é‚£ä¹ˆï¼Œåªè¦å¯¹é¢ä¸å­˜åœ¨ä¸€ä¸ªå·²è¿æ¥ä¸Šæ•°æ®åº“çš„sessionï¼Œä»–å°±æ°¸è¿œæ— æ³•çŸ¥é“ç°åœ¨çš„æ•°æ®åº“å¯†ç æ˜¯å¤šå°‘ï¼Œæ‰€ä»¥ä»–çš„gameboxè‚¯å®šä¸€ç›´å¤„äºdownæœºçŠ¶æ€ã€‚è€Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¹‹å‰çš„å†…å­˜é©¬æŒç»­æ”¶å‰²flagã€‚è¿™æ ·æ•´ä¸ªæµç¨‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±èƒ½è®©å¯¹æ–¹åˆdownåˆä¸¢åˆ†ã€‚

è€Œå¦‚æœå¯¹æ–¹é€‰æ‹©é‡ç½®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆåªè¦åœ¨ä»–ä¿®å¤æ¼æ´æˆ–è€…åˆ ç«™ä¹‹å‰èƒ½å¤Ÿé‡æ–°å†æ‰“ä¸€å‘rceï¼Œæˆ‘ä»¬å°±åˆèƒ½ä¿®æ”¹å¯¹é¢æ•°æ®åº“å¯†ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œç†è®ºä¸Šå¯ä»¥è®©å¯¹é¢æ°¸è¿œä¿®ä¸å¥½è‡ªå·±çš„æœåŠ¡ã€‚è‡³äºå†…å­˜é©¬çš„æƒé™ç»´æŒï¼Œå°±å¾—çœ‹å¤§å®¶è‡ªå·±çš„æƒé™ç»´æŒæ‰‹æ®µäº†ã€‚



## æœ€å

![Riatre](https://mo-xiaoxi.github.io/img/post/qwb/Riatre.gif)



